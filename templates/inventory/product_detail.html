{% extends 'base.html' %}
{% load static %}

{% block pagetitle %}{{ product.name }}{% endblock %}

{% block content %}
<div class="row page-titles mx-0">
    <div class="col-sm-6 p-md-0">
        <div class="welcome-text">
            <h4>Ürün Detayı</h4>
        </div>
    </div>
    <div class="col-sm-6 p-md-0 justify-content-sm-end mt-2 mt-sm-0 d-flex">
        <a href="{% url 'inventory:product_list' %}" class="btn btn-secondary mr-2">
            <i class="icon-arrow-left"></i> Geri
        </a>
        <a href="{% url 'inventory:product_update' product.pk %}" class="btn btn-info mr-2">
            <i class="icon-pencil"></i> Düzenle
        </a>
        <a href="{% url 'inventory:product_delete' product.pk %}" class="btn btn-danger">
            <i class="icon-trash"></i> Sil
        </a>
    </div>
</div>

<div class="row">
        <div class="col-lg-4">
            <div class="card">
                <div class="card-body text-center">
                    {% if product.image %}
                    <img src="{{ product.image.url }}" alt="{{ product.name }}" class="img-fluid rounded mb-3">
                    {% else %}
                    <div class="bg-light p-5 mb-3 rounded">
                        <i class="icon-bag" style="font-size: 80px; color: #999;"></i>
                    </div>
                    {% endif %}
                    
                    <h4>{{ product.name }}</h4>
                    <p class="text-muted">{{ product.sku }}</p>
                    
                    {% if not product.is_active %}
                    <span class="badge badge-secondary badge-lg">Pasif Ürün</span>
                    {% elif product.quantity == 0 %}
                    <span class="badge badge-danger badge-lg">Stokta Yok</span>
                    {% elif product.is_low_stock %}
                    <span class="badge badge-warning badge-lg">Düşük Stok</span>
                    {% else %}
                    <span class="badge badge-success badge-lg">Stokta Var</span>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h4 class="card-title">Ürün Bilgileri</h4>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <strong>Kategori:</strong>
                        </div>
                        <div class="col-md-8">
                            {% if product.category %}
                            <span class="badge badge-primary">{{ product.category.name }}</span>
                            {% else %}
                            <span class="text-muted">Kategorisiz</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-4">
                            <strong>Açıklama:</strong>
                        </div>
                        <div class="col-md-8">
                            {{ product.description|default:"Açıklama yok" }}
                        </div>
                    </div>

                    <hr>

                    <div class="row mb-3">
                        <div class="col-md-4">
                            <strong>Mevcut Miktar:</strong>
                        </div>
                        <div class="col-md-8">
                            <h5>{{ product.quantity }} adet</h5>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-4">
                            <strong>Minimum Stok:</strong>
                        </div>
                        <div class="col-md-8">
                            {{ product.min_stock_level }} adet
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-4">
                            <strong>Birim Fiyat:</strong>
                        </div>
                        <div class="col-md-8">
                            {{ product.unit_price }} ₺
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-4">
                            <strong>Toplam Değer:</strong>
                        </div>
                        <div class="col-md-8">
                            <h5 class="text-success">{{ product.total_value }} ₺</h5>
                        </div>
                    </div>

                    <hr>

                    <div class="row mb-3">
                        <div class="col-md-4">
                            <strong>Oluşturulma:</strong>
                        </div>
                        <div class="col-md-8">
                            {{ product.created_at|date:"d.m.Y H:i" }}
                            {% if product.created_by %}
                            <small class="text-muted">({{ product.created_by.username }})</small>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-4">
                            <strong>Son Güncelleme:</strong>
                        </div>
                        <div class="col-md-8">
                            {{ product.updated_at|date:"d.m.Y H:i" }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-header">
                    <h4 class="card-title">Stok Hareketleri</h4>
                </div>
                <div class="card-body">
                    {% if movements %}
                    <div class="table-responsive">
                        <table class="table table-sm table-hover">
                            <thead>
                                <tr>
                                    <th>Tarih</th>
                                    <th>İşlem</th>
                                    <th>Miktar</th>
                                    <th>Not</th>
                                    <th>İşlemi Yapan</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for movement in movements %}
                                <tr>
                                    <td>{{ movement.created_at|date:"d.m.Y H:i" }}</td>
                                    <td>
                                        {% if movement.movement_type == 'IN' %}
                                        <span class="badge badge-success">Giriş</span>
                                        {% elif movement.movement_type == 'OUT' %}
                                        <span class="badge badge-danger">Çıkış</span>
                                        {% else %}
                                        <span class="badge badge-info">Düzeltme</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if movement.movement_type == 'IN' %}
                                        <span class="text-success">+{{ movement.quantity }}</span>
                                        {% elif movement.movement_type == 'OUT' %}
                                        <span class="text-danger">-{{ movement.quantity }}</span>
                                        {% else %}
                                        {{ movement.quantity }}
                                        {% endif %}
                                    </td>
                                    <td>{{ movement.note|default:"-" }}</td>
                                    <td>{{ movement.created_by.username|default:"-" }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p class="text-center text-muted">Henüz stok hareketi yok</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}
